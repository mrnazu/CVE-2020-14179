#!/bin/bash

output_folder="results"

# Create the output folder if it doesn't exist
mkdir -p "$output_folder"

process_target() {
    host="$1"
    result_file="$output_folder/$(echo "$host" | tr -d '/' | tr -d ':').txt"

    curl_output=$(curl -s -k --insecure --path-as-is "$host/secure/QueryComponent\! Default.jspa" | grep -qsi 'searchers' && echo "Vulnerable" || echo "Not Vulnerable")

    printf "%s %s\n" "$host" "$curl_output" > "$result_file"

    if [ "$curl_output" = "Vulnerable" ]; then
        printf "%s \033[0;31mVulnerable\n" "$host"
    else
        printf "%s \033[0;32mNot Vulnerable\n" "$host"
    fi
}

if [ "$#" -eq 0 ]; then
    echo "Usage: $0 [-l <target_file> | -u <target_url>]"
    exit 1
fi

while [[ $# -gt 0 ]]; do
    case "$1" in
        -l|--list)
            if [ $# -lt 2 ]; then
                echo "Error: Missing argument for option -l|--list"
                exit 1
            fi
            target_file="$2"
            shift 2
            while read -r host; do
                process_target "$host"
            done < "$target_file"
            ;;
        -u|--url)
            if [ $# -lt 2 ]; then
                echo "Error: Missing argument for option -u|--url"
                exit 1
            fi
            target_url="$2"
            shift 2
            process_target "$target_url"
            ;;
        *)
            echo "Unknown option: $1"
            exit 1
            ;;
    esac
done

